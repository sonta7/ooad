{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}选课{% endblock %}
{% block css %}<link href="{% static 'css/classselect.css' %}" rel="stylesheet"/>{% endblock %}
{% block content %}




	<script src="../static/js/jquery-3.2.1.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="../static/js/bootstrap.js"></script>
    <script src="../static/js/bootstrap-table.js"></script>

    <!-- Latest compiled and minified Locales -->
    <script src="../static/js/bootstrap-table-zh-CN.min.js"></script>
	<script src="../static/js/ui.js"></script>
	<script src="../static/js/jquery.form.js"></script>



    <style type="text/css">
		#yijian{
			border-radius: 10px;
			background: #ffffff;
			padding: 0px 0px;
			color: #000000;
			text-transform: uppercase;
			font-size: 15px;
			outline: none;
			border-color:1px solid black;

			margin: 0 auto;
			width: 150px;
			text-align: center;
			height: 35px;
			line-height: 20px;
		}
		#yijian1{
			border-radius: 10px;
			background: #ffffff;
			padding: 0px 0px;
			color: #000000;
			text-transform: uppercase;
			font-size: 15px;
			outline: none;
			border-color:1px solid black;

			margin: 0 auto;
			width: 150px;
			text-align: center;
			height: 35px;
			line-height: 20px;
		}
		body{
			text-align:center;	
			background-size: cover;
			background-position:50% 50%;
		}
		body:before {
			content: "";	
			display: inline-block;
			vertical-align: middle;
		}
		.alert {
				width: 90%;
				text-align: center;
				color: #fff;
				margin: 10px auto;
				border-radius: 5px;
				line-height: 30px;
				cursor: pointer;
				background: #4ab819;
			}
			
			.toast {
				background: #f80851;
			}
			
			.later {
				background: #a9a9a9;
			}
        #selectBnt {
			border-radius: 10px;
			background: #30c9e8;
			padding: 0px 0px;
			border: none;
			color: #ffffff;
			text-transform: uppercase;
			font-size: 15px;
			font-family: '楷体';
			outline: none;

			margin: 0 auto;
			width: 100px;
			text-align: center;
			height: 30px;
			line-height: 20px;
		}
		
		#selectBnt:hover {
			color: #000000;
			animation: shake 0.82s cubic-bezier(.36, .07, .19, .97) both;
			transform: translate3d(0, 0, 0);
			backface-visibility: hidden;
			perspective: 1000px;
		}
		
		@keyframes shake {
			10%, 90% {
				transform: translate3d(-1px, 0, 0);
			}
			20%, 80% {
				transform: translate3d(2px, 0, 0);
			}
			30%, 50%, 70% {
				transform: translate3d(-4px, 0, 0);
			}
			40%, 60% {
				transform: translate3d(4px, 0, 0);
			}
		}
		
		.selectClass {
			display: inline-block;
			width: 200px;
			margin-left:10px;
			margin-top:15px;
			position: relative;
			vertical-align: middle;
			padding: 0;
			overflow: hidden;
			background-color: #fff;
			color: #555;
			border: 1px solid #aaa;
			text-shadow: none;
			border-radius: 25px;
			transition: box-shadow 0.25s ease;
			z-index: 2;
		}

		.selectClass:hover {
			box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
		}

		.selectClass:before {
			content: "";
			position: absolute;
			width: 0;
			height: 0;
			border: 10px solid transparent;
			border-top-color: #ccc;
			top: 14px;
			right: 10px;
			cursor: pointer;
			z-index: -2;
		}
		.selectClass select {
			cursor: pointer;
			padding: 10px;
			width: 100%;
			border: none;
			background: transparent;
			background-image: none;
			-webkit-appearance: none;
			-moz-appearance: none;
		}

		.selectClass select:focus {
			outline: none;
		}
		
		table.display.table.table-hover tr:nth-child(odd) {
			background-color:#F5F5F5;
		}
		

		table.display.table.table-hover tr:nth-child(even) {
			background-color:#ffffff;
		}

		table.display.table.table-hover tr:hover{
			transform:scale(1,1.1);
			font-size:16px;
		}
		
		table.display.table.table-hover th{
			background-color:#ffffff;
		}
		
		.win { display: none; }
.mask-layer { position: fixed; width: 100%; height: 100%; opacity: 0.5; filter: alpha(opacity=50); background-color: black; z-index: 99998; top: 0px; left: 0px; }
.window-panel { position: fixed; z-index: 99999; top: 50%; left: 50%; background-color: white; border-radius: 4px; }
.window-panel .title-panel { position: absolute; height: 36px; width: 100%; border-radius: 4px 4px 0 0; }
.window-panel .title { position: absolute; height: 36px; width: 100%; text-align: center; border-radius: 4px 4px 0 0; line-height: 36px; vertical-align: middle; background-color: whitesmoke; /*标题背景色*/ border-bottom: 1px solid rgb(233, 233, 233); z-index: 1; }
.window-panel h3 { font-size: 16px; margin: 0; }
.window-panel .close-btn { display: block; text-align: center; vertical-align: middle; position: absolute; width: 36px; height: 36px; line-height: 36px; right: 0px; text-decoration: none; font-size: 24px; color: black; background-color: #DBDBDB; border-radius: 2px; z-index: 1; }
.window-panel .close-btn:hover { background-color: #ccc; }
.window-panel .body-panel { position: absolute; width: 100%; top: 36px; border-radius: 0 0 4px 4px; z-index: 1;background: #fff;background-image: url(../images/wenli.png); }
.window-panel .body-panel.toast-panel{ position: absolute;color:#fff;background:rgba(0,0,0,0.3); }
.window-panel .content, .window-panel .btns { text-align: center; }
.window-panel .content { padding: 10px 10px 0px 10px; font-size: 16px; min-height: 40px; line-height: 22px; }
.window-panel .content.toast-content{padding:0;min-height:0;}
.window-panel .w-btn { display: inline-block; width: 60px; height: 26px; line-height: 26px; background-color: #DE5923; color: white; cursor: pointer; text-align: center; border-radius: 2px; text-decoration: none; margin: 0 10px 0px 10px; border: none; }
.window-panel .w-btn:hover { background-color: #DA3E00; }
.window-panel .w-btn:focus { outline: 0 none; }


        </style>

    <script>
    function actionFormatter(value,row,index) {
          return '<button id="selectBnt" class="mod">选课</button> ';


    }
    window.actionEvents = {

  'click .mod': function(e, value, row, index) {
      var a = row.courseid
     var url = "classselect/"+a
    function confirmed() {
          var msg = "确认选课？"
          if(confirm(msg)==true){
              return true;
          }else{
              return false;
          }
      }
      if(confirmed()) {
          $.get(url, {}, function (data) {
              mizhu.toast(data);
              if(data=='选课成功') {
                  setTimeout(function () {
                    window.location.reload();
					}, 700);
              }

          })
      }
     //修改操作
     }


  }
  
  function postQueryParams(params) {
              var a = document.getElementById('s');

       var tmp =
           {
               limit: params.limit,   //页面大小

              offset: params.offset,  //偏移量
               search:params.search,
               status: a.options[a.selectedIndex].textContent


           }


       return tmp

  }


    </script>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="myModalLabel">
					一键选课
				</h4>
			</div>
			<div class="modal-body">


  <form id="themeForm" action=""  method="post"  target="submitFrame" enctype="multipart/form-data" >

                                                 
                            <div class="col-sm-4">
							{% csrf_token %}
							<div style="margin-left:200px">
    <input type="text" name="lastname" value="课程编号或名称">
	    <input id="yijian" style="margin-top:20px" type="submit" value="提交课程编号或名称"></form>
		</div>
		<div style="margin-top:20px;margin-left:150px">
                            <form id="themeForm2"action=""  method="post"  target="submitFrame" enctype="multipart/form-data">
                                {% csrf_token %}
                                <select id="usertype" style="width:250px" name="usertype" class="selectpicker show-tick form-control" multiple data-live-search="false">
                                {% for a in selected_course %}
                                    <option value={{a.name}}>{{ a.name }}</option>
                                    {% endfor %}
                                </select>
								<input id="yijian1" style="margin-top:20px;margin-left:50px" type="submit" value="提交">
								</form>
	</div>
</div>
			<div class="modal-footer">
                
                            </div>


                <script>
                    function isSelectItemExit(objSelectId,objItemValue){
  var objSelect=document.getElementById(objSelectId);
  for(var index=0;index<objSelect.length;index++){
   if(objSelect.options[index].value==objItemValue){
     return true;
   }
  }
}
function addOneItemToSelect(objSelectId,objItemText,objItemValue){
  var objSelect=document.getElementById(objSelectId);
  if(null != objSelect && typeof(objSelect) != "undefined"){
    if(isSelectItemExit(objSelectId,objItemValue)){
      alert('兄弟，这个值已经存在了');
    }
    else{
      var varItem=new Option(objItemText,objItemValue);
      objSelect.options.add(varItem);
            alert("添加成功。")
    }
  }
}



 $("#themeForm").ajaxForm(function(data){
    if(data.toString().indexOf("OK")!=-1){
           var ss = data.toString().substr(2)

  addOneItemToSelect("usertype",ss,ss);

        {#           slt.options.add(new Option(choosen[i]))#}

    }
    else{
        alert(data)
    }
　　　　});

 $("#themeForm2").ajaxForm(function(data){
    if(data.toString().indexOf("OK")!=-1){
           var ss = data.toString().substr(2)

  addOneItemToSelect("usertype",ss,ss);

        {#           slt.options.add(new Option(choosen[i]))#}

    }
    else{
        alert(data)
    }
　　　　});


</script>

                 {% csrf_token %}


			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
    　　 <iframe  id="submitFrame" style="display: none;width:0; height:0" name="submitFrame"  src="about:blank"></iframe>
	
	
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
<table id="show" text-align="center" class="display table  table-hover" data-toggle="table"
                data-url="{% url 'showcourse' 'select'   %}"
                data-method="get"
                data-show-columns="true"
                data-pagination="true"
                data-side-pagination="server"
                data-page-list="[10, 20, 50, 100, 200]"
                data-search="true" data-mobile-responsive="true" searchOnEnterKey="true"
                data-show-refresh="true" data-show-columns="true"
                data-show-toggle="true" data-page-size=20 data-unique-id="asset_id"
                data-striped="false"
                data-query-params="postQueryParams">
              
			  
			  <script>

  function hello(){
      var a = document.getElementById('s');

      $('#show').bootstrapTable('refresh');

  }

 </script>

              <thead text-align="center">
              <ul class="nav nav-pills pull-left">
				<div class="selectClass">
                  <select id="s">
                  <option name="all" value="all"   selected = "selected">所有课程</option>
                <option name="generalSelective" value="generalSelective">通识选修</option>
                      <option name="plan" value="plan">本学期计划选课</option>
                      <option name="plancrossyear" value="plancrossyear">专业跨年级</option>

                 </select>
				 </div>

                  <button type="button" style="margin-left:50px;margin-top:15px;background:#464646" id="btn_query" class="btn btn-primary" onclick=hello()>查询</button>
				  
				  <!-- 按钮触发模态框 -->
					<button type="button" style="margin-left:50px;margin-top:18px;background:#464646;height:35px;line-height:0px;font-size:15px;text-align:center" class="btn btn-primary btn-lg pull-right" data-toggle="modal" data-target="#myModal">
					一键选课
					</button>
				<!-- 模态框（Modal） -->


 </ul>
                    <tr>
                        <th data-field="courseid" data-align="center">Id</th>
                        <th data-field="coursecode" data-align="center">课程编号</th>
                        <th data-field="coursename" data-align="center">课程名称</th>
                        <th data-field="teacher" data-align="center">任课教师</th>
                        <th data-field="classroom" data-align="center">教室</th>
                        <th data-field="time" data-align="center">上课时间</th>
                        <th data-field="credit" data-align="center">学分</th>
                        <th data-field="capacity" data-align="center">课余量</th>
                        <th data-field="operation" data-formatter="actionFormatter" data-events="actionEvents"}>选择</th>

                     </tr>

              </thead>

 

{#</table>#}
{##}
{##}
{#	<table>#}
{#	<thead>#}
{#	<tr>#}
{#		<th>课程名称  </th>#}
{#        <th>学分   </th>#}
{#        <th>选择</th>#}
{#		<th>任课教师</th>#}
{#		<th>课程类型</th>#}
{#		<th>上课教室</th>#}
{#		<th>上课时间</th>#}
{#		<th>起始周</th>#}
{#		<th>剩余数量</th>#}
{#		<th>是否选课</th>		#}
{#	</tr>#}
{#	</thead>#}
{#	<tbody>#}
{#	{% for lessonlist in classes %}#}
{#	<tr>#}
{#    <form action="" method="POST">#}
{#        {% csrf_token %}#}
{#		<td>{{lessonlist.name}}</td>#}
{#		<td>{{lessonlist.credit}}</td>#}
{#        <td><input type="submit" value="{{ lessonlist.name }}" name="class"/></td></form>#}
{#    </tr>#}
{#	{% endfor %}#}
{#</table>#}

{#			<a class="button-success pure-button" href="/managelesson/">管理已选课程</a>#}
{#	<script>#}
{#		function autoCheck(name,limit){#}
{#			   var cks = document.getElementsByName(name);#}
{#			    function check() {#}
{#			        var checkedNum = 0;#}
{#			        for (var i = 0,len = cks.length; i < len ;i++) {#}
{#			            if(cks[i].checked) checkedNum++;#}
{#			            if(checkedNum > limit) {#}
{#			                return false;#}
{#			            }    #}
{#			        }#}
{#			        return true;#}
{#			   }#}
{#			    for (var i = 0,len = cks.length; i < len ;i++) {#}
{#			        cks[i].onclick = function (){#}
{#			            if(!check()){  #}
{#			                alert("一个学期最多选择"+limit+"门课");  #}
{#			                this.checked = false;  #}
{#			            }  #}
{#			        }#}
{#			    } #}
{#			};#}
{#			autoCheck("check_box_list",2);#}
{#	</script>#}
            <style type="text/css">
            table{
                border: 1px solid #ccc;
                border-collapse: collapse;
                text-align: center;
            }
            tr,th,td{
                width: 160px;
                height: 60px;
                border: 1px solid #ccc;
				text-align:center;
            }

        </style>

            <table  align="center" style="margin-bottom:20px">
            <caption>当前学期课表 您还剩{{ score1 }}分可以选择。</caption>
            <thead align="center">
                <tr>
                    <th></th>
                    <th align="center">星期一</th>
                    <th align="center">星期二</th>
                    <th align="center">星期三</th>
                    <th align="center">星期四</th>
                    <th align="center">星期五</th>
                    <th align="center">星期六</th>
                    <th align="center">星期日</th>
                </tr>

            </thead>
            <tbody>
                <tr>
                    <td rowspan="2">上午</td>

                   <td class="Mon"></td>
                    <td class="Tue"></td>
                    <td class="Wed"></td>
                    <td class="Thu"></td>
                    <td class="Fri"></td>
                    <td class="Sat"></td>
                    <td class="Sun"></td>
                </tr>
                <tr>
                   <td class="Mon"></td>
                    <td class="Tue"></td>
                    <td class="Wed"></td>
                    <td class="Thu"></td>
                    <td class="Fri"></td>
                    <td class="Sat"></td>
                    <td class="Sun"></td>
                </tr>

                <tr>
                    <td rowspan="2">下午</td>
                    <td class="Mon"></td>
                    <td class="Tue"></td>
                    <td class="Wed"></td>
                    <td class="Thu"></td>
                    <td class="Fri"></td>
                    <td class="Sat"></td>
                    <td class="Sun"></td>
                </tr>
                <tr>

                   <td class="Mon"></td>
                    <td class="Tue"></td>
                    <td class="Wed"></td>
                    <td class="Thu"></td>
                    <td class="Fri"></td>
                    <td class="Sat"></td>
                    <td class="Sun"></td>
                </tr>
            <tr>
                    <td rowspan="1">晚上</td>
                    <td class="Mon"></td>
                    <td class="Tue" id=1></td>
                    <td class="Wed"></td>
                    <td class="Thu"></td>
                    <td class="Fri"></td>
                    <td class="Sat"></td>
                    <td class="Sun"></td>
                </tr>


            </tbody>
        </table>


{% for course in courses %}
   {%  for time in course.time.all %}

        <script>
        var a = document.getElementsByClassName('{{ time.day }}')
        {% if time.week == 0 %}
            var b = ""
        {% endif %}
        {% if time.week == 1 %}
            var b = "单周"
        {% endif %}
        {% if time.week == 2 %}
            var b = "双周"
        {% endif %}
        var c = b + '{{ course.lession.name }},{{ course.teacher }}'


        a.item(parseInt({{ time.number_choice }})-1).textContent +=  c
        </script>
   {%  endfor  %}




{%  endfor %}


    {% if messages %}
        <script>
            {% for msg in messages %}
                alert('{{ msg.message }}');
            {% endfor %}
        </script>
    {% endif %}

{% endblock %}
